house of spirit 
----------------

free시에 인자로 전달될 힙의 주소를 조작할 수 있다면 , 
free후 tcache에 저장될 주소가 free시에 전달된 인자의 주소가 될 것이다. 
그렇게 하면 다음 할당시엔 tcache에 있는 주소 영역에 할당을 하게 되므로, 
free시에 인자로 전달한 주소값 위치에 메모리 할당이 이뤄진다. 

소스 코드를 보면, 맨 처음에 이름을 입력한 메모리 영역인 스택의 주소를 출력하고 , 
메뉴를 통해 데이터를 할당받거나 할당 해제한다. 

1번메뉴에서는 입력받은 크기만큼 메모리를 할당하고 쓰기가 가능하다. 
2번메뉴에서는 입력한 주소를 인자로 free 함수를 호출한다. 

시나리오를 짜보면, ret를 덮을 수 있는만큼 사이즈를 계산하여 프로그램 시작 시 이름 영역에 입력하고, 
이후 얻은 스택주소를 가지고 free를 진행한 다음, 
해당 스택 영역에 그대로 문자열을 입력받아 ret를 get_shell 함수의 주소로 덮어 씌우면 되겠다. 
이때 free 시킬 주소는 data 영역을 가리키고 있어야하므로 , 얻은주소 +0x10을 넣어주자. 

입력받는 위치는 rbp-0x30으로, ret를 덮어씌우려면 0x10 바이트가 더 필요하다. 
0x40 바이트 만큼 할당 해제 당하게끔 만들어줘야 하므로 size로 인식될 위치에 0x40을 적어주자. 

좀 더 이해를 돕기위해, 스택주소를 인자로 free 하기 전에 0x40 크기 힙 하나를 할당 진행하여 
tcache entry에 스택 주소가 들어가는 것을 확인했다. 
```
gdb-peda$ heapinfo
(0x20)     fastbin[0]: 0x0
(0x30)     fastbin[1]: 0x0
(0x40)     fastbin[2]: 0x0
(0x50)     fastbin[3]: 0x0
(0x60)     fastbin[4]: 0x0
(0x70)     fastbin[5]: 0x0
(0x80)     fastbin[6]: 0x0
(0x90)     fastbin[7]: 0x0
(0xa0)     fastbin[8]: 0x0
(0xb0)     fastbin[9]: 0x0
                  top: 0x1d202a0 (size : 0x20d60) 
       last_remainder: 0x0 (size : 0x0) 
            unsortbin: 0x0
(0x40)   tcache_entry[2](1): 0x7fff8dcefaf0
```
이제 다음번 0x40 크기 청크 할당시 해당 스택 영역에 입력을 받을 것이다. 